# 3DE4.script.hide: 			true
# 3DE4.script.startup: 			true

import os
import sys
import tde4
from PySide import QtGui, QtCore

pc_path = os.getenv('TANK_CURRENT_PC')
sys.path.append(
    os.path.join(pc_path, 'install', 'core', 'python')
)
import tank

def _timer():
    QtCore.QCoreApplication.processEvents()

if __name__ == '__main__':
    if not tank.platform.current_engine():
        from tank_vendor.shotgun_authentication import ShotgunAuthenticator
        user = ShotgunAuthenticator(tank.util.CoreDefaultsManager()).get_user()
        tank.set_authenticated_user(user)
        tk = tank.tank_from_path(pc_path)
        context = tk.context_from_path(tk.project_path)
        #tank.path_cache.PathCache(tk).synchronize()
        engine = tank.platform.start_engine('tk-3de4', tk, context)

    # Qt
    if not QtCore.QCoreApplication.instance():
        QtGui.QApplication([])
        tde4.setTimerCallbackFunction("_timer", 100)

